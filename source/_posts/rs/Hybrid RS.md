---
title: 混合推荐系统(Hybrid Recommender Systems)
date: 2019-12-12 22:48:02
tags:
---

## 什么是混合推荐系统

混合推荐算法就是利用两种或者两种以上推荐算法来配合，克服单个算法存在的问题，期望更好地提升推荐的效果。

## 混合推荐系统的价值

### 当前主流推荐算法存在的问题

1. 冷启动问题
2. 数据稀疏性问题
3. 马太效应
4. 灰羊（gray sheep）效应
   - 是指某些用户的倾向性和偏好不太明显，比较散乱，没有表现出对具备某些特征的标的物强烈的偏好。这种偏好性不强的用户跟其他用户的相似度都差不多，选择不同的相似用户没啥差别，因此推荐效果不是特别好。
5. 投资组合效应（portfolio effect）
   - 由于从不同渠道获得的标的物是非常相似的，推荐系统可能会推荐非常相关的标的物给用户，但对用户来说，这些相关的标的物是重复的、无价值的。
6. 稳定性（stabillity）/可塑性（plasticity）问题
   - 当用户的兴趣稳定下来后，(推荐)系统很难改变对用户的认知，即使用户兴趣最近变化了，推荐系统还是保留了用户过往的兴趣，除非当用户新兴趣积累到足够多，所起的作用完全盖过了老的兴趣。一般解决该问题的思路可以对用户兴趣进行时间衰减操作，最近行为权重更大，越久远的行为权重越小。

| 推荐算法 | 依赖的数据               | 存在的问题       | 优势                                                                                                 |
| -------- | ------------------------ | ---------------- | ---------------------------------------------------------------------------------------------------- |
| 基于内容 | 用户行为数据，物品元数据 | 1、3、5、6       | 积累的数据越多，相关越好；不需要太多领域知识；只需要隐私反馈就可以进行推荐                           |
| 协同过滤 | 用户行为数据             | 1、2、3、4、5、6 | 不需要物品元数据；可以挖掘用户新兴趣点；只需要隐式反馈就可以建模；不需要领域知识，数据越多，效果越好 |
| 热门推荐 | 用户行为数据             | 3、5、6          | 算法简单，复杂度低                                                                                   |

## 混合推荐系统的实现方案

### 单体的（Monolithic）混合范式

- 特征组合(Feature Combination)混合
  - 比如基于矩阵分解获得每个物品的特征向量，基于内容的推荐利用物品之间的元数据计算相似度，整合前面两者得到的相似度。
- 特征增强(Feature Augmentation)混合
  - 特征增强混合是另一个单体混合算法，不同于特征组合简单地结合或者预处理不同的数据输入，特征增强会利用更加复杂的处理和变换，第一个算法可能事先预处理第二个算法依赖的数据，生成中间可用的特征或者数据(中间态)，再供第二个算法使用最终生成推荐结果。

### 并行的（Parallelized）混合范式

- 掺杂(Mixed)混合
  - 掺杂方法将多个推荐算法的结果混合起来，最终推荐给某个用户。
  - 这些物品需要先排序再最终展示给用户，一般不同算法的排序逻辑不一样，直接按照不同算法的得分进行粗暴排序往往存在问题。可以将不同的算法预测的得分统一到可比较的范围(比如可以先将每个算法的得分归一化到 0-1 之间)，再根据归一化后的得分大小来排序。
- 加权(Weighted)混合
  - 加权方法利用多个推荐算法的推荐结果，通过加权来获得每个推荐候选标的物的加权得分，最终来排序。
- 分支（Switching）混合
  - 分支混合根据某个判别规则来决定在某种情况发生时，利用某个推荐算法的推荐结果。
  - 分支条件可以是与用户状态相关的，也可以是跟上下文相关的。
    - 如果用户是新用户，用热门推荐，当用户行为足够多时，用协同过滤算法给用户做推荐；
    - 时间：如果用户在早上使用产品，给用户推荐新闻；
    - 地点：当用户在某个新的地点使用美团外卖，可以给用户推荐当地特色菜肴；
    - 在信息流推荐中，当用户手动下滑时，给用户更新基于用户最新行为的相关推荐结果；

### 流水线（Pipelined）混合范式

一个推荐算法生成的推荐结果给到另外一个推荐算法作为输入(该算法可能还会利用其它的数据输入)，再产生推荐结果，输入到下一个推荐算法，依次类推。

- 级联(Cascade)混合
  - 一个算法的推荐结果作为输出给到下一个算法作为输入之一，下一个算法只会调整上一个算法的推荐结果的排序或者剔除掉部分结果，而不会新增推荐标的物。
  - 排在级联混合第一个算法后面的算法的输入除了前面一个算法的输出外，可能还会利用其它的数据来训练推荐算法模型，级联的目的是优化上一个算法的排序结果或者剔除不合适的推荐，通过级联会减少最终推荐结果的数量。
- 元级别(Meta-level)混合
  - 在元级别的混合中一个推荐算法构建的模型会被流水线后面的算法使用，用于生成推荐结果

并行的混合推荐范式是对业务侵入最小的一种方式，因为混合阶段只是对不同算法的结果进行简单混合。但是由于使用了多个推荐算法的结果，整个推荐的计算复杂度会更高，并且多个算法的推荐结果的得分怎么在同一个框架中具备可比性也是比较棘手的、需要处理好的问题。

流水线式的混合策略是最复杂耗时的一类混合方案，需要对前后的两个算法有很好的理解，并且它们也需要配合好才能最终产生比单个算法好的结果，但如果能将几个差别较大(差别较大，混合后预测的方差会更小，类似遗传中的杂交优势)的推荐算法很好地整合起来时，往往收获也是较大的。

## 工业级推荐系统与混合推荐

工业级推荐系统中一般将整个推荐流程分为召回、排序、策略调控 3 个阶段。

- 召回阶段的目的是通过利用不同的推荐算法将用户可能喜欢的标的物从海量标的物库(千万级或者上亿)中筛选出一个足够小的子集(几百上千)。
- 排序阶段，对召回阶段多种召回算法混合后的推荐结果进行精细排序，因此从召回到排序这两个阶段的 pipeline 就是前面提到的级联混合推荐策略。
- 业务调控阶段，会根据业务规则及运营需求，对排序阶段的推荐结果进行调整，可能会调整顺序，插入需要强运营的标的物，插入广告等。这一阶段的处理是比较偏业务的，可能会更多偏规则

### 实时推荐系统与混合推荐

实时个性化推荐基于用户最近的行为近实时更新用户的推荐列表，对计算能力、算法、服务响应等都有极高的要求。从用户最近的行为获得用户短期偏好，这算是一种推荐算法，将短期偏好获得的推荐结果与原来 T+1 推荐结果融合推荐给用户也是一种算法的混合，一般可以采用加权的混合方式，最粗暴的方式是将短期偏好推荐结果置于最高的权重，直接放在推荐列表最前面。

### 深度学习等复杂推荐模型整合多数据源

深度学习模型这种具备整合用户行为数据、标的物 metadata 数据、用户画像数据等数据的能力，是非常有优势的，相当于将协同过滤、基于内容的推荐等多种算法的能力融合到一个模型。

### 特殊情况下的处理策略

推荐系统属于互联网软件服务，任何软件服务都存在不确定性，因而会存在一定概率出现问题，对推荐系统也不例外。当由于网络故障或者服务故障导致推荐服务不可用时，给出一组备选方案展示出来，这样虽然推荐的结果不会那么精准，但不至于什么结果都没有，明显可以提升用户体验。具体的做法可以是在 APP 启动时，客户端通过一个独立的接口获得一组默认推荐(比如热门推荐)存入客户端本地存储中，当故障出现时，就用这一组默认推荐来填补，这种策略其实是一种分支混合推荐策略。

### 推荐数量不足的增补

在真实工业级推荐场景中，最终的推荐算法一般会给出固定数量的推荐结果(比如 50 个，但是在前端可能只展现 30 个)，如果某个用户的推荐列表下线的标的物较少，导致最终数量不够前端展现时，一般会采用补足的策略，比如利用热门推荐的结果填补不足的数量，最终获得规定好的数量(如前面提到的 50 个)，这个利用另外一个推荐算法(如热门推荐)来填补的策略就是掺杂混合策略。

### 通过混合策略解决用户冷启动

真实业务场景下的推荐系统不可避免会存在用户冷启动问题，特别是对于提供 toC 服务的、成长型的互联网公司。一般可以采用分支混合的推荐策略： - 对于没有操作行为的刚进入的新用户可以采用默认的热门推荐或者通过编辑人工精选的多样性的内容作为推荐。 - 而对于有少量用户行为的用户，这时可以采用基于内容的推荐(如基于标签的推荐) - 当用户的行为足够多时采用矩阵分解等协同过滤推荐算法

## 对混合推荐系统的思考

推荐系统的混合不光有算法的混合，还有数据源的混合、多类别标的物的混合、应用场景的混合。

- 整合实时推荐中用户短期和长期兴趣
- 利用单个复杂模型建模多源信息
- 多源的标的物混合
- 家庭场景中多人兴趣的混合推荐
- 用户在多 APP 场景下行为的混合
- 用户多状态（场景）的融合推荐
