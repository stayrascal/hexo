---
title: recsys
date: 2019-07-22 22:58:17
tags:
---

## 推荐系统介绍

### 关于推荐系统的一些思考

大多数学术界对于传统推荐算法的论文主要是对协同过滤的改进，从而最终得到一个相对原先算法有很大提升的结果。但是都过于理想化，真实的环境远远要比试验环境复杂的多，网上最有名的数据就是电影评分数据，只有用户对电影的评分以及一些简单的电影的信息，基于这个数据的推荐算法有些理想化，没法模拟出真实的环境。数据的缺乏也是导致协同过滤大行其道的原因。
工业界的推荐系统需要明确价值走向。比如在电商系统中如果是为了增加交易总额，那么可以过滤一些廉价的商品，根据用户对不同价格阶段的需求惊喜推荐，如果是为了增加用户停留时间，提高 CTR，那么推荐系统就不应该考虑过多别的因素，只找到用户最感兴趣的商品就行，这些如果仅仅只使用传统的协同过滤来做是很难满足的。
目前工业界使用最多的算法差不多都是 GBDT，LR，DNN。
所有推荐算法都面临一个海量数据的问题，这个时候的做法就是先通过一些基础的模型进行数据准备，比如用户画像，用户的价格偏好，购买力水平等， 然后根据已有的用户数据和特征进行召回，得到用户比较感兴趣的一些数据，然后再根据推荐模型进行偏好排序，过滤掉已经购买过的数据，从而推荐给用户。

### 推荐系统的先决条件

1. 足够的数据：一个错误的思路是我的社区不够活跃，上个用户推荐系统加强活跃吧。这是一种错误的逻辑，推荐系统是数据挖掘的一个应用，没有数据，通常都不会产生什么有价值的挖掘，除了基本的用户物品数据以外，在推荐系统不断完善的过程中，我们一般会使用不同上下文条件下的用户行为数据、用户标签数据、社交网络数据
2. 丰富的内容：推荐系统起源于亚马逊的图书推荐，为什么亚马逊是第一个吃螃蟹的人，贝佐斯把书店帮到网上后，发现自己拥有了全世界最多的图书，在数百万的书店里，根本无法依赖任何一个店员帮顾客推荐新书。只有内容极大丰富的时候，才可能有被无用户差别排行榜埋没的优质内容，个性化需求才能体现出商业价值。
3. 用户分众：数据充分了，内容丰富了，还需要考虑用户的口味能不能产生足够的分众。推荐系统之所以在电商、音乐上有成功的应用，最主要的因素是这类产品有足够的分众，越是大而全的领域，用户的分众越明显，推荐的效果越好。这也是淘宝的推荐系统比唯品会做的好的原因

### 推荐场景

1. 电商
   - 今日推荐 => 通常是根据用户的近期的历史购买或查看记录，并结合时下流行的物品给出一个这种的推荐
   - 猜你喜欢/看了又看 => Content-Based 计算物品的相似度，结合 Item-Based 的协同过滤，同时给出推荐理由，购买此物品的用户百分之多少也购买了那个物品，或者因为你购物车中有什么，因为你购买过什么，所有给你推荐什么，以及社交推荐你的朋友买过这类的产品
   - 新产品的推荐：采用基于内容的推荐机制，将一些新到品种推荐给用户
   - 捆绑销售：采用数据挖掘技术对用户的购买行为进行分析，找到经常被一起或一个人购买的物品集，进行捆绑销售，是一种典型的基于物品的协同过滤推荐机制
   - 别人购买/浏览的商品：典型的基于项目的协同过滤推荐应用，通过社会化机制用户能更快更方便的找到自己感兴趣的物品
2. 音乐
   - 根据音乐的基因计算音乐之间的相似度
   - 物品空间大、消费代价小、物品种类丰富、重用率很高、上下文相关、不需要用户全神贯注、高度社会化
3. 社交网络
   - 利用用户的社交网络信息对用户进行个性化的物品推荐
   - 信息流的会话推荐
   - 给用户推荐好友
4. 个性化阅读
   - 文章多，用户面临信息过载
   - 用户没有必要看某篇具体文章的需求，只想通过阅读特定领域的文章了解这些领域的动态
5. 基于位置的服务
   - 往往和社交网络结合在一起

### 不适合推荐系统的场景

个性化推荐的成功应用需要两个条件。第一是存在信息过载，因为如果用户可以很容易地从所有物品中找到喜欢的物品，就不需要个性化推荐了。第二是用户大部分时候没有特别明确的需求，因为用户如果有明确的需求，可以直接通过搜索引擎找到感兴趣的物品。

### 推荐系统的挑战

1. 数据稀疏是推荐系统中常见的问题，通常采用引入一些新的召回机制如文本相似性等非行为相关的召回制补充用户行为的不足。
2. 冷启动的问题，对于全新的用户，可以在第一次着陆到首页采用一些大众化的推荐，当用户有进一步的行为便可以根据行为进行新的推荐了。
   - 用户冷企动可以采用基于物品的推荐或者其他推荐方式；
   - 物品冷启动可以使用基于用户的或其他推荐方式；或者提取部分流量进行探索，探索用户的兴趣。
3. 大数据处理与增量计算，在有高数据量的日志，PV，数据增量的情况下，推荐次数也会非常巨大，对于所有组件必须能处理大量的数据，所以整体的架构以分布式和实时增量计算为主。
4. 多样性与精确性，推荐除了要考虑准确的召回，同时也要兼顾用户体验，避免推荐结果的单一化，也需要增加一些多样性的考虑。
5. 用户行为模式的挖掘和利用，用本质上说，推荐就是在做用户行为模工挖掘，找出用户的行为特征，给出相应的预测，这里面涉及到大量的算法和工程问题。
6. 多维数据的交叉利用，除了线上数据，我有时候会从其他渠道收集数据，这些数据也可以引入推荐系统，提升推荐的效果。
7. 效果评估，一套完整的推荐系统，必须一套完整的评估体系，好的推荐系统需要对每个推荐栏位都有详细的效果评估，除了推荐栏维度的点击率、转化率，还有商品维度和用户维度的相关评估指标。

### 推荐系统额评测指标

1. 评分系统用 RMSE 和 MAE 来评判两者之间的差异性
2. Top N 推荐用准确率和召回率评定用户对推荐的喜欢程度。准确度表示我们推荐的商品中用户感兴趣的比例，召回率表示用户感兴趣的产品中我们推荐到的商品的比例
3. 推荐系统希望消除马太效应，覆盖率表示对物品长尾的发掘能力。从信息熵的角度来看，p(i)是推荐商品 i 的概率，当每个商品推出去的次数相当时 H 最大，能更有效的判定覆盖率
4. 多样性表示推荐列表中物品两两之间的不相似性
5. 新颖性：表示给用户推荐之前没有听说过的物品
6. 惊喜度：表示推荐结果和用户的历史兴趣不相似。和新颖性的区别是新颖性是没有听说过的物品，但可能是和历史物品相似没有听说过的
7. 信任度：指用户对推荐系统的信任度，可以提供给用户推荐理由以及利用好友、信任人的信息给用户推荐来提高信任度
8. 健壮性：指一个推荐系统防止作弊的能力
   以上指标并不是越高越好，几项指标都有内在联系。比如多样性和新颖性高了准确度就会下降，所以几项指标的最优搭配，才是衡量一个好推荐系统的标准。最基础的做法就是在给定覆盖率、多样性、新颖性等限制条件下，尽量优化准确度

### 推荐系统容易忽略的问题

1. 交互方式：比如今日头条资讯类下拉刷新一次是加载 6 条，8 条还是 10 条，每次加载策略的调整都会对用户行为产生极大的影响。以及推荐过程中的引导，有时候引导比推荐的内容更重要，这也是社交推荐为什么不需要什么模型而效果很好的原因，如果推荐区域有任何的图片或数字时，想办法让他们更有诱惑力
2. 推荐效果：如何内容质量本身很垃圾啊，结构化程度极低，那么引入更多，更丰富的内容，远比推荐系统要来的事半功倍
3. 算法融合：因为用户的使用场景是多样化的，一种算法逻辑很难覆盖到所有的场景，最好的方式是采用最适配该场景的算法逻辑
4. 广义推荐：比如社交化社交场景，朋友分享了一个东西，你觉得很好，这也是一个很好的推荐系统
5. 热门和长尾的矛盾：推荐系统主要还是以提升点击率为目标，但是往往横向对比之后，个性化推荐的指标往往不如热门推荐。所以有的人尝试用热门混杂长尾的方法来达到鱼和熊掌兼得的目前。但是我们所想要做的推荐系统，应该只有一个目标，那就是满足用户的个性化需求。如果一定要最求点击量的话，那就专门使用热门推荐来赚取点击量

### 推荐系统的实施

1. 借助更多信息：在做推荐之前把产品彻底弄熟，来确定能获取到哪些用户行为和用户数据
2. 相关性：如果两个数据相关度很高的话，在使用回归模型的时候能减少很多运算量
3. 业务场景：物推物适合采用 ItemBased，ContentBased, 一个个展现的可以考虑加入随机性，首页推荐应该多放新品
4. 目标：需定义长期目标和短期目标，比如长期目标是提升用户的活跃度，短期指标应该着重几点：有没有更多的内容被发现，热门排行榜的更新是否加快？用户对推荐的点击是否在一个比较活跃的水平？如果是 UGC 的产品，用户有没有因为更容易被发现而积极地上传内容，当然这些指标都必须被量化
5. 引导：有时候引导比推荐的内容更重要
6. 收集反馈：收集一切跟推荐有关的数据，比如推荐区域的停留于点击、推荐内容的反馈、连续点击推荐内容的链条、对推荐系统的评价
7. 离线实验：不要迷信离线的结果，离线实验的结果通常和线上相差很大
8. 耐心：推荐系统不是一个立竿见影的产品，上线之后还需要多花时间收集数据、调整参数、做更多的分组测试、更重要的是，leader 要有耐心

### 推荐系统整体架构

1. 存储层
   - Redis 集群
     - 用于存储热门数据，包括资源（商品或者咨询）ID，名称，链接，图片，分类，品牌等。这些信息数量不算非常多，但是使用频率非常高，基本上每次推荐都要用到数十甚至数百个商品信息。之所以选用 Redis，是它的速度，持久化和以及主从机制。
     - 使用一个 Master 带若干个 Slaves 以便实现读写分离，Master 只负责写，Slaves 只负责读，其中两个 Slave 有序列化机制，并且必定有两个 Slave 在不同的机器上以消除单点故障隐患。
   - Membase 集群/HBase
     - 扮演主存的角色，主要用于支持推荐引擎的计算。
     - 推荐引擎包含多个在线和离线计算模块，这些模块计算过程中需要用到很多数据，并产生以及大量的中间结果，包括用户在各个网站的行为历史，资源之间的关系等等。这些数据的特点是不需要 Schema，数量多，但绝大多的使用频率很低。之所以选用 Membase，主要原因是因为它可以很方便的进行横向扩展以及有丰富的 Client API 支持。
   - MySQL 集群：储最终的统计数据以及其他客户配置信息等小规模的数据。
   - Hadoop/HDFS：存储原始数据，比如一些批量导入的原始日志信息。
2. 算法层
   - 在线算法：协同过滤、基于内容的推荐、流行度推荐、用户的行为模式
   - 离线算法：KNN 聚类、FP Growth 关联规则挖掘、基于上下文统计的关联规则挖掘、序列模式算法、文档建模算法
   - 算法层并不关心具体的业务逻辑，而只负责数据处理和结果返回。以热扩散算法为例，一方面它接受（用户，资源，偏好指数）的三元组作为计算输入，实时计算用户与用户/资源之间的关系；另外，我们也可以向它请求某个用户对哪些资源最感兴趣，或者某个资源与哪些资源最相关。
   - 将业务逻辑和推荐算法本身剥离这样的设计方式使得推荐算法具有了最大的通用性，也保证了前端的推荐功能模块可以根据逻辑需求综合多个算法。比如基于浏览历史的个性化推荐就可以使用到热扩散和基于内容的推荐两种算法。
3. 业务层
   - 收集数据：数据客户端提交的数据，并将其转换为各个推荐算法需要的输入内容，交由推荐算法计算
   - 处理请求：根据客户端提交的推荐请求，向一个或几个推荐算法请求数据，并转换为客户端想要的数据格式
4. 管理层
   - 服务监控：CPU、Memory 资源占用情况；Redis、Membase 运行情况；Log 信息；异常告警
   - 配置管理、DNS：服务注册中心

### 推荐系统常遇的问题以及解决办法

- 数据稀疏性问题
  - 简单填值法：
    - 均值、插值法：在小规模数据集上可以采取均值，插值的方式进行填充，这种方式没有考虑到用户兴趣差异，抹杀了用户个性。
    - 众数法：从统计学的角度来说，众数法预测的准确率会比较高，实际生活中，众数法预测的结果可能是错的，同时用户的数据中可能存在多个众数或者没有众数的情况，所以应用局限性比较大。
  - 聚类法：聚类算法用相似群体的评分信息提升预测的准确度，但不能体现用户之间的差异，因此推荐的准确率并没有得到显著的提高
    - 层次聚类法
    - biclustering 聚类
    - co-clustering 聚类
  - 降维：降维技术在一定程度上能够减少数据的规模和稀疏程度，也对流失一部分用户和物品的相关数据。降维的效果和数据密集程度相关，在项目空间维度不是很高的情况下进行降维，效果难以得到保证。
    - 简单降温方法：根据一些限制条件删除对应的用户和物品，在一定程度上起到降维的作用，但是无法对删除的用户和物品进行推荐，导致用户丢失和信息隐藏的问题
    - 矩阵分解
    - 主成分分析
  - 结合内容过滤：协同过滤一般只使用用户评分数据，基于内容的过滤可以使用用户的描述信息，两种方式可以结合起来增加可用的数据量

### 推荐算法

- 基于内容的推荐
  - 优点：
    - 不需要其它用户的数据，没有冷开始问题和稀疏问题。
    - 能为具有特殊兴趣爱好的用户进行推荐。
    - 能推荐新的或不是很流行的物品，没有新物品问题。
    - 推荐结果直观，可解释：通过列出推荐物品的内容特征，可以解释为什么推荐那些物品。
    - 不需要领域知识
    - 已有比较好的技术，如关于分类学习方面的技术已相当成熟。
  - 缺点：
    - 要求内容能容易抽取成有意义的特征
    - 要求特征内容有良好的结构性，并且用户的口味必须能够用内容特征形式来表达，不能显式地得到其它用户的判断情况。复杂属性不好处理
    - 稀疏问题
    - 新用户问题
    - 要有足够的数据构造分类器
- 基于协同过滤的推荐
  - 优点：
    - 对推荐对象没有特殊的要求，能处理非结构化的复杂对象，如音乐、电影
    - 能够过滤难以进行机器自动内容分析的信息，如艺术品，音乐等。
    - 共享其他人的经验，避免了内容分析的不完全和不精确，并且能够基于一些复杂的，难以表述的概念（如信息质量、个人品味）进行过滤。
    - 新异兴趣发现、不需要领域知识：有推荐新信息的能力。可以发现内容上完全不相似的信息，用户对推荐信息的内容事先是预料不到的。
    - 能够有效的使用其他相似用户的反馈信息，较少用户的反馈量，加快个性化学习的速度。
    - 随着时间推移性能提高；
    - 推荐个性化、自动化程度高；
  - 缺点：
    - 在数据存在稀疏性的时候，效果不佳
    - 存在可扩展问题
    - 新用户问题；
    - 质量取决于历史数据集；
    - 系统开始时推荐质量差；
- 基于关联规则的推荐
  - 优点：
    - 能发现新兴趣点；
    - 不要领域知识
  - 缺点：
    - 规则抽取难、耗时：算法的第一步关联规则的发现最为关键且最耗时，是算法的瓶颈，但可以离线进行
    - 商品名称的同义性问题也是关联规则的一个难点
    - 个性化程度低；
- 基于效用推荐：建立在对用户使用项目的效用情况上计算的，其核心问题是怎么样为每一个用户去创建一个效用函数
  - 优点：
    - 无冷开始和稀疏问题；
    - 对用户偏好变化敏感；
    - 能考虑非产品特性，如可靠性和物品可得性
  - 缺点：
    - 用户必须输入效用函数；
    - 推荐是静态的，灵活性差；
    - 属性重叠问题；
- 基于知识的推荐：在某种程度是可以看成是一种推理（Inference）技术，它不是建立在用户需要和偏好基础上推荐的
  - 优点：
    - 能把用户需求映射到产品上；
    - 能考虑非产品属性
  - 缺点：
    - 知识难以获得
    - 推荐是静态的，灵活性差

### 度量相似度的方法

- 余弦相似度
- 修正的余弦相似度：余弦相似度没有考虑不同用户评分尺问题，修正的余弦相似度通过减去用户对物品的平均评分解决上述问题
- 相关相似度：
  - 皮尔逊相关系数

### 人工策略辅助推荐算法

因为推荐算法的局限性，或者数据的局限性，有一些重要的目标，是无法使用算法拟合的。这些目标，有些甚至无法数值化的来衡量。但是定性的可以看出很重要。这类的目标，需要人工的去使用策略或者说规则控制。典型的有:
1、广告，导流类（比如头条的问答，微头条）特型内容的插入频次
2、低俗，低质，恶心，标题党等违法违规，欺骗性质内容。欺骗机器的"善良"，需要其他规则辅助打压内容或者账号。
3、重要新闻，需要置顶，强插，因为机器短时间学习不到它为啥这么重要，这类内容又需要及时曝光。
4、运营机制：需要对新作者，原创作者做流量倾斜保护。

### 文本特征

#### 头条的文本特征主要分类以下几类

第一部分是语义标签，由人工预定义的，有明确意义的显式特征（需要持续标注，新名词，新概念会不断出现）。
第二部分是隐式语义特征，主要由 topic 跟关键词组成。语义标签分为：分类，概念，实体。不同层级的要求不一样。 - 分类体系要求召回高，准确率要求不是特别高。 - 实体不要求覆盖全，尽量覆盖每个领域的热门人物，机构，作品，产品等。 - 概念体系负责表达抽象的，但是又有精确意义的概念，也不要求覆盖全。 - 分类算法，分享的是层次化文本分类 SVM+CNN+RNN。 - 实体识别算法上，包括：分词，词性标注，抽取候选，去歧，计算相关性。

### 用户兴趣计算策略

#### 头条

1、噪声过滤：过滤停留时长短的点击，打击标题党
2、惩罚热点：用户在热门文章上的动作做降权处理
3、时间衰减：随着用户动作的增加，老的特征权重会随着时间衰减，新动作贡献的特征权重会变大。（感觉是不是可以放在长短期兴趣里）
4、惩罚展现：不止使用正样本，如果用户不点击推荐的内容，则会惩罚。（这个应该是部分特征或者算法吧？）
5、考虑全局背景：考虑给定特征的人均点击比例（做 L1norm）


## AB试验平台
大众点评：Gemini https://www.csdn.net/article/2015-03-24/2824303
微博广告：Faraday http://blog.csdn.net/petpig0312/article/details/73825986
阿里的一个文章：http://blog.sina.com.cn/s/blog_e59371cc0102vopg.html
PPTV：https://www.cnblogs.com/sunxf2011/p/5793267.html


### Unknown

根据不同用户的喜好挖掘生成用户画像，为每位用户提供“千人千面”的个性化推荐内容，帮助传媒、电商等行业有效提升点击率、转化率及用户粘性，极大地增加客户的经营效益

个性化推荐、相关推荐、热门推荐

- 多维度挖掘用户长短期兴趣画像，精准把脉用户偏好诉求
- 多策略融合优化推荐的多样性、新颖性、时效性，给用户惊喜的结果
- 反应迅速，秒级响应用户点击反馈，实时更新推荐结果

- 基于海量用户行为历史数据 挖掘多样性的高质量个性化推荐结果
- 基于高性能计算框架 秒级生成新用户画像，快速完成冷热转换
- 不断吸收引进前沿的预测算法 对用户实时兴趣和个性化需求进行精准预测

技术特色

- 多维度挖掘用户长短期兴趣画像，精准把握用户偏好诉求，实时响应点击反馈更新推荐结果
- 融合多种算法模型，突破传统推荐系统单调重复的问题，给用户丰富全面的内容推荐
- 领先的“三级火箭”设计架构，同时兼顾算法灵敏性与系统稳定性，确保在复杂情况下的高性能运作
- 利用高性能计算框架，秒级生成新用户画像，并不断融合前沿算法进行精准预测，提高用户留存率

* 客户期望构建一个成熟的推荐系统服务，来提升用户活跃度、点击率、留存率等一系列商业指标

  - 客户现在缺乏构建这样一个推荐服务的基础设施和数据
    - 我们可以针对用户的业务场景和数据量提供如下相关的咨询或交付服务
      - 数据平台基础设施构建
      - 如何基于现有业务场景和产品设置定制数据采集方案方式
      - 数据存储
      - 搭建实时个性化推荐服务(包括特征工程构建用户画像、模型设计训练优化和推荐服务)
      - 推荐物品 UI 设计
      - A/B 实验平台
  - 客户现在已近具备一定的数据和基础设施
    - 我们可以针对用户的业务场景和数据量提供如下相关的咨询或交付服务
      - 数据采集方法优化
      - 数据存储优化
      - 搭建实时个性化推荐服务(包括特征工程构建用户画像、模型设计训练优化和推荐服务)
      - UI 优化

* 客户只是期望我们帮助他们完成类似精准营销之类的离线版的产品推荐，来验证“推荐”是否对其业务有效
  - 客户缺乏数据
    - 我们可以针对用户的业务场景和数据量提供如下相关的咨询或交付服务
      - 根据相关业务目标集成现有数据或者爬取需要的第三方数据
      - 根据业务场景构建离线推荐模型，计算推荐结果（包括模型训练所依赖的特征工作）
      - 推荐系统设计咨询
  - 客服拥有数据
    - 我们可以针对客户的业务场景和数据量提供如下相关的咨询或交付服务
      - 根据业务场景构建离线推荐模型，计算推荐结果（包括模型训练所依赖的特征工作）
      - 推荐系统设计咨询

我们可以根据客户提供的数据深入洞察用户行为，构建用户偏好视图，为用户提供跨屏的、实时的、“千人千面”的个性化推荐服务，帮助用户获取感兴趣的产品、资讯及服务，有效提升用户活跃度、点击率及留存率等关键指标。

jbs.codemonk.cn
