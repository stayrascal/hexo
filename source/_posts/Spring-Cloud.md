---
title: Spring-Cloud
date: 2017-08-18 22:51:48
tags:
---

# Spring Cloud

### Eureka
* CAP
    - C: 数据一致性
    - A: 服务可用性
    - P: 服务对网络分区的容错性
* ZooKeeper
    - CP
        * 即任何时刻对ZooKeeper的访问请求能得到一致的数据结果
        * 系统对网络分割具备容错性
        * 不能保证每次服务请求的可用性(在极端环境下，ZooKeeper可能会丢弃一些请求)
    - ZooKeeper是分布式协调服务，职责是保证数据(配置数据，状态数据)在其管辖下的所有服务之间保持同步、一致
    - 作为一个分布式协同服务，ZooKeeper非常好，但是对于Service发现服务来说就不合适了
        * 对于Service发现服务而言 返回了包含不实的信息的结果也比什么都不返回要好
        * 对于Service发现服务而言，宁可返回某服务5分钟之前在哪几个服务器上可用的信息，也不能因为暂时的网络故障而找不到可用的服务器，而不返回任何结果
        * 如果被用作Service发现服务，ZooKeeper本身并没有正确的处理网络分割的问题
* Eureka
    - AP
    - 独立的客户端程序库，同时提供心 跳服务、服务健康监测、自动发布服务与自动刷新缓存的功能
    - 在Eureka平台中，如果某台服务器宕机，Eureka不会有类似于ZooKeeper的选举leader的过程，客户端请求会自动切换到新的Eureka节点
    - 当宕机的服务器重新恢复后，Eureka会再次将其纳入到服务器集群管理之中
    - Eureka甚至被设计用来应付范围更广 的网络分割故障，并实现“0”宕机维护需求
        * 当网络分割故障发生时，每个Eureka节点，会持续的对外提供服务
        * 接收新的服务注册同时将它们提供给下游的服务发现请求
    - Eureka内置了心跳服务，用于淘汰一些“濒死”的服务器
        * 如果在Eureka中注册的服务，它的“心跳”变得迟缓时，Eureka会将其整个剔除出管理范围
        * 如果Eureka服务节点在短时间里丢失了大量的心跳连接，那么这个Eureka节点会进入"自我保护模式"，同时保留那些"心跳死亡"的服务注册信息不过期，此时，这个Eureka节点对于新的服务还能提供注册服务，对于"死亡"的仍然保留，以防还有客户端向其发起请求。当网络故障恢复后，这个Eureka节点会退出"自我保护模式"
    - Eureka还有客户端缓存功能
        * 即便Eureka集群中所有节点都失效，或者发生网络分割故障导致客户端不能访问任何一台Eureka服务器；Eureka服务的消费者仍然可以通过Eureka客户端缓存来获取现有的服务注册信息
        * 甚至最极端的环境下，所有正常的Eureka节点都不对请求产生相应，消费者服务仍然可以通过Eureka客户端查询与获取注册服务信息
        
